# ============================================================================
# GENERAL OPTIONS
# ============================================================================

# Mouse support and terminal settings
set -g mouse on
set -g default-terminal "tmux-256color"
set-option -sa terminal-overrides ",xterm*:Tc"
set-option -g status-position top

# Window and pane numbering
set -g base-index 1                   # Start windows at 1, not 0
setw -g pane-base-index 1             # Start panes at 1, not 0
set-window-option -g pane-base-index 1
set-option -g renumber-windows on     # Renumber windows when one is closed

# Window behavior
set-option -g allow-rename off        # Don't rename windows automatically

# ============================================================================
# PREFIX KEY
# ============================================================================

unbind C-b
set -g prefix C-g

# ============================================================================
# KEY BINDINGS
# ============================================================================

# Configuration reload
unbind r
bind r source-file ~/.config/tmux/tmux.conf \; display-message "tmux.conf reloaded ☺️"

# Pane splitting (open in current directory)
bind '"' split-window -v -c "#{pane_current_path}"
bind '-' split-window -v -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"
bind '|' split-window -h -c "#{pane_current_path}"

# Window navigation
bind -n C-S-h previous-window
bind -n C-S-l next-window
bind -n M-S-Left previous-window
bind -n M-S-Right next-window

# Smart pane/window navigation with Alt + Arrow keys
# Alt + Left/Right switches panes unless at screen edge, then switches windows
bind -n M-Left if-shell "tmux display-message -p '#{pane_at_left}' | grep -q 1" "previous-window" "select-pane -L"
bind -n M-Right if-shell "tmux display-message -p '#{pane_at_right}' | grep -q 1" "next-window" "select-pane -R"
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Pane resizing with leader + HJKL
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Pane resizing with leader + Arrow keys
bind -r Left resize-pane -L 5
bind -r Down resize-pane -D 5
bind -r Up resize-pane -U 5
bind -r Right resize-pane -R 5

# Window reordering
bind-key -n M-i swap-window -t -1\; select-window -t -1
bind-key -n M-o swap-window -t +1\; select-window -t +1

# ============================================================================
# VI MODE & COPY MODE
# ============================================================================

set-window-option -g mode-keys vi

# Vi-style copy mode keybindings
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# ============================================================================
# PLUGINS
# ============================================================================

# Plugin manager
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'

# Theme
set -g @plugin 'catppuccin/tmux'

# Functionality plugins
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'omerxx/tmux-floax'
set -g @plugin 'tmux-plugins/tmux-resurrect'

# Commented out plugins (uncomment if needed)
# set -g @plugin 'tmux-plugins/tmux-cpu'
# set -g @plugin 'tmux-plugins/tmux-battery'

# ============================================================================
# PLUGIN CONFIGURATION
# ============================================================================

# Floax configuration
# M- means "hold Meta/Alt"
set -g @floax-bind '-n M-f'

# Catppuccin theme configuration
set -g @catppuccin_flavor "frappe"
set -g @catppuccin_window_status_style "basic"
set -g @catppuccin_window_current_text " #{window_name}"
set -g @catppuccin_window_text " #{window_name}"

# ============================================================================
# STATUS LINE CONFIGURATION
# ============================================================================

# Status line length settings
set -g status-right-length 100
set -g status-left-length 100
set -g status-left ""

# Status line modules
set -g status-right "#{E:@catppuccin_status_application}"
set -ag status-right "#{E:@catppuccin_status_session}"

# Commented out status modules (uncomment if needed)
# set -agF status-right "#{E:@catppuccin_status_cpu}"
# set -ag status-right "#{E:@catppuccin_status_uptime}"
# set -agF status-right "#{E:@catppuccin_status_battery}"

# ============================================================================
# INITIALIZE PLUGIN MANAGER
# ============================================================================

# Initialize TPM (keep this line at the very bottom of tmux.conf)
run '~/.config/tmux/plugins/tpm/tpm'
